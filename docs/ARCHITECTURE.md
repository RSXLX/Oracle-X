# Oracle-X 系统架构文档

## 1. 系统架构总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Oracle-X 系统架构                              │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                           用户层 (User Layer)                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐  │
│  │   Desktop UI    │  │  System Tray   │  │   Notification         │  │
│  │   (Electron)    │  │   (托盘图标)    │  │   (系统通知)            │  │
│  │   ✅ 已完成     │  │   ✅ 已完成     │  │   ✅ 已完成            │  │
│  └────────┬────────┘  └────────┬────────┘  └───────────┬─────────────┘  │
└───────────│────────────────────│──────────────────────│──────────────────┘
            │                    │                      │
            ▼                    ▼                      ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         核心服务层 (Core Services)                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────────────┐ │
│  │  GlobalMonitor   │  │ScreenshotAnalyzer│  │   DecisionEngine     │ │
│  │  (全局监听器)    │  │  (截图AI分析)    │  │   (决策引擎)         │ │
│  │  ✅ 已完成      │  │   ✅ 已完成      │  │   ✅ 已完成          │ │
│  └────────┬─────────┘  └────────┬─────────┘  └───────────┬────────────┘ │
│           │                      │                        │              │
│  ┌────────┴──────────────────────┴────────────────────────┴───────────┐ │
│  │                        IPC Bridge (进程通信)                         │ │
│  │                         ✅ 已完成                                     │ │
│  └────────────────────────────────┬────────────────────────────────────┘ │
└───────────────────────────────────┼─────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       数据持久层 (Data Layer)                           │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────────────────┐ │
│  │ SettingsStore  │  │  DecisionLog   │  │     StatsTracker         │ │
│  │  (设置存储)    │  │  (决策日志)     │  │     (统计追踪)           │ │
│  │  ✅ 已完成    │  │   ✅ 已完成    │  │     ✅ 已完成            │ │
│  └────────────────┘  └────────────────┘  └────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. 数据流图 (Data Flow Diagram)

### 2.1 主数据流

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   用户打开   │────▶│  初始化配置   │────▶│  启动监听   │
│  交易App    │     │   加载设置    │     │  全局监控   │
└──────────────┘     └──────────────┘     └──────┬───────┘
                                                  │
                                                  ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   阻断弹窗   │◀────│   AI 分析    │◀────│  截图捕获   │
│   ⚠️ 警告   │     │  (视觉识别)   │     │  定时截图   │
└──────┬───────┘     └──────┬───────┘     └──────────────┘
       │                    │
       ▼                    ▼
┌──────────────┐     ┌──────────────┐
│  记录决策    │     │  记录统计    │
│  决策日志   │     │  统计数据    │
└──────────────┘     └──────────────┘
```

### 2.2 截图 AI 分析流程

```
┌─────────────┐
│  定时截图   │  (每2秒)
└──────┬──────┘
       │
       ▼
┌─────────────────────────────────────────────────────────────┐
│                    ScreenshotAnalyzer                       │
│  ┌───────────────┐    ┌───────────────┐    ┌────────────┐ │
│  │ 图片转Base64  │───▶│  构建视觉Prompt │───▶│ 调用AI API │ │
│  └───────────────┘    └───────────────┘    └─────┬──────┘ │
└─────────────────────────────────────────────────────────────┘
                                                    │
                                                    ▼
                              ┌───────────────────────────────────┐
                              │       AI API (MiniMax)           │
                              │  BaseURL: mydmx.huoyuanqudao.cn  │
                              │  Key: sk-cXCZz...                │
                              │  ✅ 已配置可用                    │
                              └───────────────────┬───────────────┘
                                                  │
                                                  ▼
┌─────────────────────────────────────────────────────────────┐
│                      结果解析                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ {                                                    │   │
│  │   "hasTradingButtons": true,  // 检测到交易按钮     │   │
│  │   "buttons": ["买入", "BUY"],                        │   │
│  │   "platform": "Binance",                           │   │
│  │   "riskLevel": "high",      // 风险等级            │   │
│  │   "action": "block"         // 阻断/警告/允许      │   │
│  │ }                                                    │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 组件状态清单

### 3.1 核心模块

| 模块 | 文件 | 状态 | 说明 |
|------|------|------|------|
| 主进程 | `main.js` | ✅ 完成 | Electron 主进程 |
| 预加载 | `preload.js` | ✅ 完成 | IPC 桥接 |
| 全局监听 | `monitor.js` | ✅ 完成 | 应用/截图监听 |
| 截图分析 | `screenshot-analyzer.js` | ✅ 完成 | AI 视觉分析 |
| 系统托盘 | `tray-manager.js` | ✅ 完成 | 常驻托盘 |
| 开机自启 | `auto-start.js` | ✅ 完成 | 登录项管理 |
| 通知 | `notification-manager.js` | ✅ 完成 | 系统通知 |
| 设置存储 | `settings-storage.js` | ✅ 完成 | 本地持久化 |
| 统计追踪 | `stats-tracker.js` | ✅ 完成 | 统计数据 |
| 决策日志 | `decision-logger.js` | ✅ 完成 | 日志持久化 |

### 3.2 UI 组件

| 组件 | 文件 | 状态 |
|------|------|------|
| 主页面 | `index.html` | ✅ 完成 |
| 样式 | `styles.css` | ✅ 完成 |
| 脚本 | `renderer.js` | ✅ 完成 |

### 3.3 API 集成

| API | 状态 | 说明 |
|-----|------|------|
| MiniMax Vision | ✅ 已配置 | 截图分析 |
| 后端 API | ✅ 可用 | 决策日志 |

---

## 4. 待完成事项

### 4.1 高优先级

| 事项 | 状态 | 说明 |
|------|------|------|
| Desktop 打包测试 | ⏳ 待测试 | 需要实际运行 |
| 截图分析测试 | ⏳ 待测试 | 验证 AI 识别 |
| 监听功能测试 | ⏳ 待测试 | 验证应用检测 |

### 4.2 中优先级

| 事项 | 状态 | 说明 |
|------|------|------|
| 打包构建 | ⏳ 待执行 | electron-builder |
| 安装程序 | ⏳ 待制作 | DMG/EXE |

### 4.3 低优先级

| 事项 | 状态 | 说明 |
|------|------|------|
| Linux 支持 | ⏳ 待开发 | AppImage |
| Windows 支持 | ⏳ 待开发 | NSIS |

---

## 5. 快速启动命令

```bash
# 进入项目
cd /Users/sxlx/.openclaw/workspace/Oracle-X

# 启动后端 (可选)
npm run dev

# 启动 Desktop
cd desktop
npm run dev
```

---

## 6. 配置文件路径

```
~/.config/Oracle-X NoFOMO/
├── oraclex-config.json    # 用户设置
├── oraclex-stats.json     # 统计数据
└── decision-logs.json     # 决策日志
```
