# Oracle-X 系统架构文档 (v1.2.0)

## 1. 系统架构总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           Oracle-X NoFOMO                               │
│                    AI 驱动的交易冷静层 + 钱包分析                        │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                           用户层 (User Layer)                           │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────┐ │
│  │   Desktop UI    │  │  System Tray   │  │   Notification         │ │
│  │   (Electron)    │  │   (托盘图标)    │  │   (系统通知)            │ │
│  │   ✅ 已完成     │  │   ✅ 已完成     │  │   ✅ 已完成            │ │
│  └────────┬────────┘  └────────┬────────┘  └───────────┬─────────────┘ │
│           │                    │                        │               │
│  ┌────────┴────────────────────┴────────────────────────┴─────────────┐ │
│  │                       Tab 导航面板                                   │ │
│  │  👁️ 监控 │ 💰 钱包 │ 📄 CSV │ ⚙️ 设置                          │ │
│  │   ✅      │   ✅    │   ✅    │   ✅                            │ │
│  └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         核心服务层 (Core Services)                      │
│  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────────────┐ │
│  │  GlobalMonitor   │  │ScreenshotAnalyzer│  │   DecisionEngine     │ │
│  │  (全局监听器)     │  │  (截图AI分析)    │  │   (决策引擎)         │ │
│  │  ✅ 已完成       │  │   ✅ 已完成      │  │   ✅ 已完成          │ │
│  └────────┬─────────┘  └────────┬─────────┘  └───────────┬────────────┘ │
│           │                      │                        │              │
│  ┌────────┴──────────────────────┴────────────────────────┴───────────┐ │
│  │                        IPC Bridge                                 │ │
│  │                         ✅ 已完成                                  │ │
│  └────────────────────────────────┬────────────────────────────────────┘ │
└───────────────────────────────────┼─────────────────────────────────────┘
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        ▼                           ▼                           ▼
┌───────────────────┐   ┌───────────────────┐   ┌───────────────────────────┐
│   WalletAnalyzer  │   │  CSVImporter      │   │   MarketData             │
│   (钱包分析)       │   │  (CSV导入分析)     │   │   (市场数据)              │
│   ✅ 已完成       │   │   ✅ 已完成        │   │   ⏳ 待整合             │
└───────────────────┘   └───────────────────┘   └───────────────────────────┘
```

---

## 2. 功能模块清单

### 2.1 核心功能

| 模块 | 文件 | 状态 | 说明 |
|------|------|------|------|
| 主进程 | `main.js` | ✅ | Electron 主进程 + IPC |
| 预加载 | `preload.js` | ✅ | 上下文桥接 |
| 全局监听 | `monitor.js` | ✅ | 应用/截图监听 |
| 截图分析 | `screenshot-analyzer.js` | ✅ | MiniMax Vision AI |
| 系统托盘 | `tray-manager.js` | ✅ | 常驻后台 |
| 开机自启 | `auto-start.js` | ✅ | 登录项管理 |
| 通知 | `notification-manager.js` | ✅ | 系统通知 |
| 设置存储 | `settings-storage.js` | ✅ | 本地持久化 |
| 统计追踪 | `stats-tracker.js` | ✅ | 统计数据 |
| 决策日志 | `decision-logger.js` | ✅ | 日志持久化 |
| 钱包分析 | `wallet-analyzer.js` | ✅ | ETH/BSC/SOL |
| CSV 导入 | `csv-importer.js` | ✅ | 7种交易所 |

### 2.2 UI 组件

| 组件 | 文件 | 状态 |
|------|------|------|
| 主页面 | `index.html` | ✅ |
| 样式 | `styles.css` | ✅ |
| 脚本 | `renderer.js` | ✅ |

---

## 3. 支持的数据源

### 3.1 交易所 CSV 格式

| 交易所 | 状态 |
|--------|------|
| Binance | ✅ |
| OKX | ✅ |
| Bybit | ✅ |
| Coinbase | ✅ |
| Kraken | ✅ |
| Gate.io | ✅ |
| KuCoin | ✅ |
| Generic | ✅ |

### 3.2 区块链

| 链 | 状态 |
|-----|------|
| Ethereum | ✅ |
| BNB Chain | ✅ |
| Polygon | ✅ |
| Arbitrum | ✅ |
| Solana | ✅ |

---

## 4. 数据流图

### 4.1 交易习惯分析流程

```
用户导入 CSV
       │
       ▼
┌──────────────────┐
│  格式自动检测    │ ◀── 智能列映射
│  (7种交易所)     │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  数据标准化       │ ◀── 统一交易格式
│  交易记录解析    │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  市场数据整合    │ ◀── 币种分类/风险/波动率
│  (币种信息)      │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  习惯分析        │ ◀── 风格/风险/洞察
│  深度分析        │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  可视化展示      │ ◀── UI 面板
│  分析结果        │
└──────────────────┘
```

---

## 5. API 配置

| 服务 | 状态 | 说明 |
|------|------|------|
| MiniMax Vision | ✅ 已配置 | 截图 AI 分析 |
| Etherscan API | ⏳ 需用户配置 | 钱包交易 |
| CoinGecko | ✅ 免费 | 市场数据 |

---

## 6. 待完成事项

### 高优先级
- [x] Desktop 打包测试（Electron 启动验证通过）
- [x] 实际运行验证（`npm run build` + `tsc --noEmit` 通过）

### 中优先级  
- [ ] 实时市场数据整合（`market-data.js` 待集成）
- [ ] 打包构建 (DMG)

### 低优先级
- [ ] Linux 支持
- [ ] Windows 支持

### 已完成（2026-02-27）
- [x] 代理硬编码 → `HTTP_PROXY` 环境变量
- [x] Extension 设置页（settings.html/js/css）
- [x] 3 个新 API（`/api/market`、`/api/trade/history`、`/api/data/refine`）
- [x] README 重写 + EXTENSION_USAGE.md + 验收文档

---

## 7. 快速启动

```bash
# 安装依赖
cd desktop && npm install

# 启动 Desktop
npm run dev
```

---

## 8. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.2.0 | 2026-02-26 | 增强 CSV 导入 + 钱包分析 |
| v1.1.0 | 2026-02-26 | Desktop 完整功能 |
| v1.0.0 | 2026-02-25 | 初始版本 |
